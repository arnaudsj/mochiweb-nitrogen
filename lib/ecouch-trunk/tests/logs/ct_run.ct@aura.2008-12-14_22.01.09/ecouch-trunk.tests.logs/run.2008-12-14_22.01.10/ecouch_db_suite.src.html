<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head><title>/Library/Erlang/Libs/ecouch-trunk/tests/test/ecouch_db_SUITE.erl</title></head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
    1:-<b>module</b>(ecouch_db_SUITE).
    2:-<b>compile</b>(export_all).
    3:
    4:-<b>include_lib</b>("common_test/include/ct.hrl").
    5:
    6:-<b>import</b>(ct).
    7:-<b>import</b>(test_helper).
    8:-<b>import</b>(ecouch).
    9:-<b>import</b>(lists).
<a name="10"></a>   10:<i>% Let's error out if our tests take over a minute to complete. This can be reconfigured</i>
   11:<i>% on a per testcase basis in init_per_testcase.</i>
<a name=suite>   12:<b>suite</b></a>() -&gt; [{timetrap, {minutes, 1}}].
   13:
   14:
<a name=init_per_suite>   15:<b>init_per_suite</b></a>(Config) -&gt;
   16:    ok = application:start(inets),
   17:    ok = application:start(ecouch),
   18:    Config.
   19:    
<a name=end_per_suite><a name="20"></a>   20:<b>end_per_suite</b></a>(_Config) -&gt;
   21:    test_helper:delete("ecouch_ct_test"),
   22:    application:stop(ecouch),
   23:    application:stop(inets),
   24:    ok.
   25:
<a name=init_per_testcase>   26:<b>init_per_testcase</b></a>(_TestCase, Config) -&gt;
   27:    test_helper:recreate_db(),
   28:    Config.
   29:    
<a name=end_per_testcase><a name="30"></a>   30:<b>end_per_testcase</b></a>(_TestCase, Config) -&gt;
   31:    Config.
   32:
<a name=all>   33:<b>all</b></a>() -&gt; [test_database_creation, test_database_deletion, test_database_listing].
   34:
<a name=test_database_creation>   35:<b>test_database_creation</b></a>() -&gt;
   36:    [{userdata,
   37:        {doc, "Creating a new database."}}].
<a name=test_database_creation>   38:<b>test_database_creation</b></a>(_Config) -&gt;
   39:    % Make sure the database doesn't already exist
<a name="40"></a>   40:    {ok, _} = test_helper:delete("ecouch_db_example_test"),
   41:    
   42:    % Now test.
   43:    ?line {ok, {obj, [{"ok", true}]}} = ecouch:db_create("ecouch_db_example_test"),
   44:    ?line {ok, {{_,200,_}, _,_}} = http:request(delete, {"http://127.0.0.1:5984/ecouch_db_example_test", []}, [], []),
   45:    ok.
   46:
<a name=test_database_deletion>   47:<b>test_database_deletion</b></a>() -&gt;
   48:    [{userdata, {doc, "Deleting an existing database."}}].
<a name=test_database_deletion>   49:<b>test_database_deletion</b></a>(_Config) -&gt;
<a name="50"></a>   50:    {ok,{{_, 200, _}, _, _}} = test_helper:get("ecouch_ct_test"),
   51:    ?line {ok, {obj, [{"ok", true}]}} = ecouch:db_delete("ecouch_ct_test"),
   52:    {ok,{{_, 404, _}, _, _}} = test_helper:get("ecouch_ct_test"),
   53:    ok.
   54:
<a name=test_database_listing>   55:<b>test_database_listing</b></a>() -&gt;
   56:    [{userdata, {doc, "Listing the databases."}}].
   57:
<a name=test_database_listing>   58:<b>test_database_listing</b></a>(_Config) -&gt;
   59:    ?line {ok, DbList} = ecouch:db_list(),
<a name="60"></a>   60:    ?line lists:member(&lt;&lt;"ecouch_ct_test"&gt;&gt;, [DbList]),
   61:    ok.
</pre>
<hr size=1><i>The transformation of this file (62 lines) took 0.00 seconds</i><br>
</body>
</html>
